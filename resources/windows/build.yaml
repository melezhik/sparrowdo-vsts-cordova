- task: BatchScript@1
  displayName: Run npm install
  inputs:
    filename: '[% base_dir %]/npm-install.cmd'
- task: BatchScript@1
  displayName: Run npm install cordova
  inputs:
    filename: '[% base_dir %]/npm-install-cordova.cmd'
- task: BatchScript@1
  displayName: Run npm install ionic
  inputs:
    filename: '[% base_dir %]/npm-install-ionic.cmd'
- task: CmdLine@1
  displayName: Create www dir
  inputs:
    filename: perl
    arguments: -e "mkdir www"
    workingDirectory: "\$(Build.SourcesDirectory)"
[%- IF prepare_only %]
- task: BatchScript@1
  displayName: Create vsts project 
  inputs:
    filename: '[% base_dir %]/prepare.cmd'
[%- ELSE %]
- task: BatchScript@1
  displayName: Run npm install cordova-set-version
  inputs:
    filename: '[% base_dir %]/npm-install-cordova-set-version.cmd'
- task: CmdLine@1
  displayName: Remove build directory
  inputs:
    filename: perl
    arguments: [% base_dir %]/remove-old-packages.pl platforms\windows\AppPackages\
    workingDirectory: "\$(Build.SourcesDirectory)"
- task: BatchScript@1
  displayName:  Add windows plaform
  inputs:
    filename: '[% base_dir %]/platform-add.cmd'
[%- IF set_version %]
- task: CmdLine@1
  displayName: Set package version
  inputs:
    filename: perl
    arguments: [% base_dir %]/set-version.pl "\$(Build.BuildId)"
    workingDirectory: "\$(Build.SourcesDirectory)"
[%- END %]
- task: CmdLine@1
  displayName: Update configuration
  inputs:
    filename: perl
    arguments: [% base_dir %]/update-configuration.pl "\$(Build.SourceBranchName)"
    workingDirectory: "\$(Build.SourcesDirectory)"
- task: BatchScript@1
  displayName:  Build package
  inputs:
    filename: '[% base_dir %]/build.cmd'
[%- IF  build_configuration == 'debug' %]
- powershell: Compress-Archive -Path *.appx, *.appxsym -DestinationPath CordovaApp.Windows.zip -Force -Verbose
  displayName: Create appxupload file (zip)
  workingDirectory: "\$(Build.SourcesDirectory)/platforms/windows/AppPackages/CordovaApp.Windows10_0.0.1.\$(Build.BuildId)_[% build_arch %]_[% build_configuration %]_Test"
[%- ELSE %]
- powershell: Compress-Archive -Path *.appx, *.appxsym -DestinationPath CordovaApp.Windows.zip -Force -Verbose
  displayName: Create appxupload file (zip)
  workingDirectory: "\$(Build.SourcesDirectory)/platforms/windows/AppPackages/CordovaApp.Windows10_0.0.1.\$(Build.BuildId)_[% build_arch %]_Test"
[%- END %]
[%- IF  build_configuration == 'debug' %]
- powershell: Rename-Item -Path CordovaApp.Windows.zip -NewName CordovaApp.Windows.appxupload
  displayName: Create appxupload file (rename)
  workingDirectory: "\$(Build.SourcesDirectory)/platforms/windows/AppPackages/CordovaApp.Windows10_0.0.1.\$(Build.BuildId)_[% build_arch %]_[% build_configuration %]_Test"
[%- ELSE %]
- powershell: Rename-Item -Path CordovaApp.Windows.zip -NewName CordovaApp.Windows.appxupload
  displayName: Create appxupload file (rename)
  workingDirectory: "\$(Build.SourcesDirectory)/platforms/windows/AppPackages/CordovaApp.Windows10_0.0.1.\$(Build.BuildId)_[% build_arch %]_Test"
[%- END %]
[%- END %]


